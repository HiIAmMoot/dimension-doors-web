<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://unpkg.com/tailwindcss@2.2.4/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="h-screen overflow-hidden flex items-center justify-center" style="background: #edf2f7;">
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>

<div class="flex flex-col items-center" x-data="rangeSlider(18, 80, 25, 55)">
    <input class="absolute opacity-0 pointer-events-none" 
        type="range" name="age_min" min="18" max="80" :value="min">
    <input class="absolute opacity-0 pointer-events-none" 
        type="range" name="age_max" min="18" max="80" :value="max">

    <span x-text="`${min} to ${max}`"></span>

    <div class="flex items-center relative rounded bg-gray-300 w-40 h-2 mt-4" 
        x-ref="sliderEl" 
        @mouseup.window="dragLeft = dragRight = false" 
        @mousemove.window="handleThumbMouseMove($event)" 
        style="user-select: none"
    >
        <div class="absolute h-2 bg-blue-400" 
            :style="`left: ${(min - rangeMin) * 100 / range}%; right: ${100 - (max - rangeMin) * 100 / range}%`"></div>
        <div class="w-4 h-4 -ml-2 rounded-full bg-blue-500 absolute cursor-pointer" 
            @mousedown="dragLeft = true" 
            :style="`left: ${(min - rangeMin) * 100 / range}%`" 
            x-ref="minThumb"></div>
        <div class="w-4 h-4 -ml-2 rounded-full bg-blue-500 absolute cursor-pointer" 
            @mousedown="dragRight = true" 
            :style="`left: ${(max - rangeMin) * 100 / range}%`" 
            x-ref="maxThumb"></div>
    </div>
</div>

<script>
function rangeSlider(rangeMin, rangeMax, min, max) {
    return {
        range: rangeMax - rangeMin,
        rangeMin,
        rangeMax,
        min,
        max,
        dragLeft: false,
        dragRight: false,
        
        handleThumbMouseMove: function(e) {
            if (!this.dragLeft && !this.dragRight) return;

            const thumbEl = this.dragLeft ? this.$refs.minThumb : this.$refs.maxThumb;
            
            const sliderRect = this.$refs.sliderEl.getBoundingClientRect();
            
            let r = (e.clientX - sliderRect.left) / sliderRect.width;
            r = Math.max(0, Math.min(r, 1));
            const value = Math.floor(r * this.range + this.rangeMin);

            if (this.dragLeft) {
                this.min = value;
                this.max = Math.max(this.min, this.max);
            } else {
                this.max = value;
                this.min = Math.min(this.min, this.max);
            }
        }
    };
}
</script>
</body>
</html>
